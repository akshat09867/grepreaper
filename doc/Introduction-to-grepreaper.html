<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Introduction to grepreaper</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to grepreaper</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Modern file systems often include data sets that are stored in
components across multiple files. This could include daily stock pricing
changes, monthly transactions, or quarterly updates. For the purpose of
analysis, these data may be read in, filtered for relevant records, and
then combined into a single object (such as a data.frame in R). However,
this reading process is not computationally efficient. It requires
individual reads of all of the files before aggregation. If filters are
applied, this is done after the reading takes place. Many irrelevant
records therefore have to be read in.</p>
<p>Utilizing <strong>grep</strong> at the command line can facilitate
pre-filtering of data and aggregation from multiple files. Linking this
version of <strong>grep</strong> to R can help to achieve a number of
goals:</p>
<ol style="list-style-type: decimal">
<li><p>Read and aggregate data from multiple files without the need for
processing work.</p></li>
<li><p>Use pattern matching to filter data before it is read. This
supports reading and aggregating relevant data from multiple files
without loading unnecessary records.</p></li>
<li><p>Provide counts of the number of rows of relevant data in a range
of files. This can incorporate pattern matching.</p></li>
</ol>
<p>Each of these goals begins with certain assumptions about the data to
be read:</p>
<ul>
<li><p>The data are stored in delimited flat files that could reasonably
be read into a data.frame object in R with a typical file reading
program.</p></li>
<li><p>The data in each file has a similar structure in terms of
variables (columns). It would be reasonable to bind the rows from all of
the files into a single, comprehensive data.frame object.</p></li>
</ul>
<p>The <strong>grepreaper</strong> package is designed to facilitate
this reading process. It designs user-friendly functions for reading
data and counting rows without the need for the user to craft the
corresponding grep commands. This vignette will show examples of the
features and capabilities of the <strong>grepreaper</strong>
package.</p>
</div>
<div id="platform-compatibility" class="section level2">
<h2>Platform Compatibility</h2>
<p><code>grepreaper</code> is designed to be cross-platform. On
Unix-like systems (Linux and macOS), it uses the system’s native
<code>grep</code> utility. On Windows, the package requires
<strong>Rtools</strong> to be installed, which provides the necessary
<code>grep.exe</code> executable.</p>
<p>The package automatically detects the location of the
<code>grep</code> binary and handles shell-specific quoting requirements
(e.g., double quotes for Windows CMD and single quotes for Unix shells)
to ensure consistent behavior across environments.</p>
</div>
<div id="reading-data" class="section level2">
<h2>Reading Data</h2>
<p>Most typically, we use a file reading method to load data. As an
example, the <strong>fread()</strong> function from the
<strong>data.table</strong> package can read a delimited file. We will
work with the <strong>diamonds</strong> data from the
<strong>ggplot2</strong> library. Here this file is stored in a .csv
file:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>diamonds <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="at">input =</span> <span class="st">&quot;diamonds.csv&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>diamonds[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##    carat     cut  color clarity depth table price     x     y     z
##    &lt;num&gt;  &lt;char&gt; &lt;char&gt;  &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
## 1:  0.23   Ideal      E     SI2  61.5    55   326  3.95  3.98  2.43
## 2:  0.21 Premium      E     SI1  59.8    61   326  3.89  3.84  2.31
## 3:  0.23    Good      E     VS1  56.9    65   327  4.05  4.07  2.31
## 4:  0.29 Premium      I     VS2  62.4    58   334  4.20  4.23  2.63
## 5:  0.31    Good      J     SI2  63.3    58   335  4.34  4.35  2.75</code></pre>
<p>With these data, we could subsequently filter the records to only
show diamonds listed as “Ideal” in the <strong>cut</strong>
variable:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>ideal <span class="ot">&lt;-</span> diamonds[cut <span class="sc">==</span> <span class="st">&quot;Ideal&quot;</span>,]</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>ideal[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##    carat    cut  color clarity depth table price     x     y     z
##    &lt;num&gt; &lt;char&gt; &lt;char&gt;  &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
## 1:  0.23  Ideal      E     SI2  61.5    55   326  3.95  3.98  2.43
## 2:  0.23  Ideal      J     VS1  62.8    56   340  3.93  3.90  2.46
## 3:  0.31  Ideal      J     SI2  62.2    54   344  4.35  4.37  2.71
## 4:  0.30  Ideal      I     SI2  62.0    54   348  4.31  4.34  2.68
## 5:  0.33  Ideal      I     SI2  61.8    55   403  4.49  4.51  2.78</code></pre>
<p>Utilizing <strong>grep</strong> at the command line provides another
option to read the data. This can be performed within data.table’s
fread() function:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>diamonds <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="at">cmd =</span> <span class="st">&quot;grep &#39;&#39; &#39;diamonds.csv&#39;&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>diamonds[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##    carat     cut  color clarity depth table price     x     y     z
##    &lt;num&gt;  &lt;char&gt; &lt;char&gt;  &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
## 1:  0.23   Ideal      E     SI2  61.5    55   326  3.95  3.98  2.43
## 2:  0.21 Premium      E     SI1  59.8    61   326  3.89  3.84  2.31
## 3:  0.23    Good      E     VS1  56.9    65   327  4.05  4.07  2.31
## 4:  0.29 Premium      I     VS2  62.4    58   334  4.20  4.23  2.63
## 5:  0.31    Good      J     SI2  63.3    58   335  4.34  4.35  2.75</code></pre>
<p>With grep, it is also possible to pre-filter the data based upon
pattern matching:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>ideal <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="at">cmd =</span> <span class="st">&quot;grep &#39;Ideal&#39; &#39;diamonds.csv&#39;&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>ideal[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##       V1     V2     V3     V4    V5    V6    V7    V8    V9   V10
##    &lt;num&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
## 1:  0.23  Ideal      E    SI2  61.5    55   326  3.95  3.98  2.43
## 2:  0.23  Ideal      J    VS1  62.8    56   340  3.93  3.90  2.46
## 3:  0.31  Ideal      J    SI2  62.2    54   344  4.35  4.37  2.71
## 4:  0.30  Ideal      I    SI2  62.0    54   348  4.31  4.34  2.68
## 5:  0.33  Ideal      I    SI2  61.8    55   403  4.49  4.51  2.78</code></pre>
<p>Notice that this approach removes the headers. However, the method is
otherwise sound. With grep, we can pre-filter the data.</p>
<p>While some users may be eager to learn command line programming
tools, the goal of our work is to simplify this approach. The
<strong>grepreaper</strong> library designs simple functions for reading
and pre-filtering data.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>diamonds <span class="ot">&lt;-</span> <span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>diamonds[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##    carat     cut  color clarity depth table price     x     y     z
##    &lt;num&gt;  &lt;char&gt; &lt;char&gt;  &lt;char&gt; &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
## 1:  0.23   Ideal      E     SI2  61.5    55   326  3.95  3.98  2.43
## 2:  0.21 Premium      E     SI1  59.8    61   326  3.89  3.84  2.31
## 3:  0.23    Good      E     VS1  56.9    65   327  4.05  4.07  2.31
## 4:  0.29 Premium      I     VS2  62.4    58   334  4.20  4.23  2.63
## 5:  0.31    Good      J     SI2  63.3    58   335  4.34  4.35  2.75</code></pre>
</div>
<div id="showing-the-underlying-grep-command" class="section level2">
<h2>Showing the Underlying grep Command</h2>
<p>The grep_read() function can also demonstrate the underlying grep
command:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">show_cmd =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;&#39;/usr/bin/grep&#39; &#39;&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/diamonds.csv&#39;&quot;</code></pre>
<p>This is useful for educational purposes and to better understand how
the data are being read.</p>
</div>
<div id="reading-and-pre-filtering-data" class="section level2">
<h2>Reading and Pre-Filtering Data</h2>
<p>A filter can be established by adding the pattern:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>ideal <span class="ot">&lt;-</span> <span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;Ideal&quot;</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>ideal[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##    carat    cut  color clarity depth table price     x     y     z
##    &lt;num&gt; &lt;char&gt; &lt;char&gt;  &lt;char&gt; &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
## 1:  0.23  Ideal      E     SI2  61.5    55   326  3.95  3.98  2.43
## 2:  0.23  Ideal      J     VS1  62.8    56   340  3.93  3.90  2.46
## 3:  0.31  Ideal      J     SI2  62.2    54   344  4.35  4.37  2.71
## 4:  0.30  Ideal      I     SI2  62.0    54   348  4.31  4.34  2.68
## 5:  0.33  Ideal      I     SI2  61.8    55   403  4.49  4.51  2.78</code></pre>
<p>This would correspond to the following grep command:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;Ideal&quot;</span>, <span class="at">show_cmd =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;&#39;/usr/bin/grep&#39; &#39;Ideal&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/diamonds.csv&#39;&quot;</code></pre>
<p>You can also search for multiple patterns (using OR logic):</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>multiple_cuts <span class="ot">&lt;-</span> <span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">&quot;Ideal&quot;</span>, <span class="st">&quot;Very Good&quot;</span>))</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>multiple_cuts[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##    carat       cut  color clarity depth table price     x     y     z
##    &lt;num&gt;    &lt;char&gt; &lt;char&gt;  &lt;char&gt; &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
## 1:  0.23     Ideal      E     SI2  61.5    55   326  3.95  3.98  2.43
## 2:  0.24 Very Good      J    VVS2  62.8    57   336  3.94  3.96  2.48
## 3:  0.24 Very Good      I    VVS1  62.3    57   336  3.95  3.98  2.47
## 4:  0.26 Very Good      H     SI1  61.9    55   337  4.07  4.11  2.53
## 5:  0.23 Very Good      H     VS1  59.4    61   338  4.00  4.05  2.39</code></pre>
<p>We could also display the construction of this grep command:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">&quot;Ideal&quot;</span>, <span class="st">&quot;Very Good&quot;</span>), <span class="at">show_cmd =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;&#39;/usr/bin/grep&#39; -e &#39;Ideal&#39; -e &#39;Very Good&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/diamonds.csv&#39;&quot;</code></pre>
</div>
<div id="special-options" class="section level2">
<h2>Special Options</h2>
<p>File reading with grep also allows for some variations on filtering.
The grep_read() function has a number of options built in:</p>
<ul>
<li><strong>invert</strong>: Search for records that do NOT contain the
requested pattern:</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">&quot;SI2&quot;</span>), <span class="at">invert =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##    carat       cut  color clarity depth table price     x     y     z
##    &lt;num&gt;    &lt;char&gt; &lt;char&gt;  &lt;char&gt; &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
## 1:  0.21   Premium      E     SI1  59.8    61   326  3.89  3.84  2.31
## 2:  0.23      Good      E     VS1  56.9    65   327  4.05  4.07  2.31
## 3:  0.29   Premium      I     VS2  62.4    58   334  4.20  4.23  2.63
## 4:  0.24 Very Good      J    VVS2  62.8    57   336  3.94  3.96  2.48
## 5:  0.24 Very Good      I    VVS1  62.3    57   336  3.95  3.98  2.47</code></pre>
<p>This adds the -v option to the grep command:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">&quot;SI2&quot;</span>), <span class="at">invert =</span> <span class="cn">TRUE</span>, <span class="at">show_cmd =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;&#39;/usr/bin/grep&#39; -v &#39;SI2&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/diamonds.csv&#39;&quot;</code></pre>
<ul>
<li><strong>ignore_case</strong>: Identify any records that contain the
pattern without regard to case sensitivity:</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">&quot;ideal&quot;</span>), <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##    carat    cut  color clarity depth table price     x     y     z
##    &lt;num&gt; &lt;char&gt; &lt;char&gt;  &lt;char&gt; &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
## 1:  0.23  Ideal      E     SI2  61.5    55   326  3.95  3.98  2.43
## 2:  0.23  Ideal      J     VS1  62.8    56   340  3.93  3.90  2.46
## 3:  0.31  Ideal      J     SI2  62.2    54   344  4.35  4.37  2.71
## 4:  0.30  Ideal      I     SI2  62.0    54   348  4.31  4.34  2.68
## 5:  0.33  Ideal      I     SI2  61.8    55   403  4.49  4.51  2.78</code></pre>
<p>This adds the -i option to the grep command:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">&quot;ideal&quot;</span>), <span class="at">ignore_case =</span> <span class="cn">TRUE</span>, <span class="at">show_cmd =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;&#39;/usr/bin/grep&#39; -i &#39;ideal&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/diamonds.csv&#39;&quot;</code></pre>
<ul>
<li><strong>fixed</strong>: The pattern will be supplied in a fixed
manner, exactly as written.</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;IdEaL&quot;</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span> ,<span class="at">fixed =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##    carat    cut  color clarity depth table price     x     y     z
##    &lt;num&gt; &lt;char&gt; &lt;char&gt;  &lt;char&gt; &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
## 1:  0.23  Ideal      E     SI2  61.5    55   326  3.95  3.98  2.43
## 2:  0.23  Ideal      J     VS1  62.8    56   340  3.93  3.90  2.46
## 3:  0.31  Ideal      J     SI2  62.2    54   344  4.35  4.37  2.71
## 4:  0.30  Ideal      I     SI2  62.0    54   348  4.31  4.34  2.68
## 5:  0.33  Ideal      I     SI2  61.8    55   403  4.49  4.51  2.78</code></pre>
<p>This adds the -F option to the grep command:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;IdEaL&quot;</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span> ,<span class="at">fixed =</span> <span class="cn">TRUE</span>, <span class="at">show_cmd =</span> T)</span></code></pre></div>
<pre><code>## [1] &quot;&#39;/usr/bin/grep&#39; -i -F &#39;IdEaL&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/diamonds.csv&#39;&quot;</code></pre>
<ul>
<li><strong>recursive</strong>: This will search recursively for all
files within a folder and its subfolders. Note that it would be
necessary to specify a path and potentially a file_pattern.</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">path =</span> <span class="st">&quot;.&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">pattern =</span> <span class="st">&quot;Ideal&quot;</span>, <span class="at">file_pattern =</span> <span class="st">&quot;.csv&quot;</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##    carat    cut  color clarity depth table price     x     y     z
##    &lt;num&gt; &lt;char&gt; &lt;char&gt;  &lt;char&gt; &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
## 1:  0.23  Ideal      E     SI2  61.5    55   326  3.95  3.98  2.43
## 2:  0.23  Ideal      J     VS1  62.8    56   340  3.93  3.90  2.46
## 3:  0.31  Ideal      J     SI2  62.2    54   344  4.35  4.37  2.71
## 4:  0.30  Ideal      I     SI2  62.0    54   348  4.31  4.34  2.68
## 5:  0.33  Ideal      I     SI2  61.8    55   403  4.49  4.51  2.78</code></pre>
<p>This adds the -r option to the grep command. Note that recursive
searching will include a larger number of files, which can greatly
lengthen the command.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>cmd <span class="ot">&lt;-</span> <span class="fu">grep_read</span>(<span class="at">path =</span> <span class="st">&quot;.&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">pattern =</span> <span class="st">&quot;Ideal&quot;</span>, <span class="at">file_pattern =</span> <span class="st">&quot;.csv&quot;</span>, <span class="at">show_cmd =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="fu">substring</span>(<span class="at">text =</span> cmd, <span class="at">first =</span> <span class="dv">1</span>, <span class="at">last =</span> <span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] &quot;&#39;/usr/bin/grep&#39; -r -H &#39;Ideal&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/diamonds.csv&#39; &#39;/tmp/RtmpBDbY6w/gr&quot;</code></pre>
<ul>
<li><strong>word_match</strong>: This restricts the matches to entire
words rather than portions of words.</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;VS1&quot;</span>, <span class="at">word_match =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##       carat       cut  color clarity depth table price     x     y     z
##       &lt;num&gt;    &lt;char&gt; &lt;char&gt;  &lt;char&gt; &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
##    1:  0.23      Good      E     VS1  56.9    65   327  4.05  4.07  2.31
##    2:  0.23 Very Good      H     VS1  59.4    61   338  4.00  4.05  2.39
##    3:  0.23     Ideal      J     VS1  62.8    56   340  3.93  3.90  2.46
##    4:  0.23 Very Good      H     VS1  61.0    57   353  3.94  3.96  2.41
##    5:  0.24   Premium      I     VS1  62.5    57   355  3.97  3.94  2.47
##   ---                                                                   
## 8167:  0.57   Premium      E     VS1  61.6    58  2753  5.36  5.33  3.29
## 8168:  0.84      Good      I     VS1  63.7    59  2753  5.94  5.90  3.77
## 8169:  0.76   Premium      I     VS1  59.3    62  2753  5.93  5.85  3.49
## 8170:  0.70 Very Good      D     VS1  63.1    59  2755  5.67  5.58  3.55
## 8171:  0.71     Ideal      G     VS1  61.4    56  2756  5.76  5.73  3.53</code></pre>
<p>Notice that using word_match limits the search results to only
diamonds with a clarity of ‘VS1’. Diamonds that are ‘VVS1’ would
otherwise match the pattern without an exact word match.</p>
<p>This adds the -w option to the grep command.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;VS1&quot;</span>, <span class="at">word_match =</span> <span class="cn">TRUE</span>, <span class="at">show_cmd =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;&#39;/usr/bin/grep&#39; -w &#39;VS1&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/diamonds.csv&#39;&quot;</code></pre>
<ul>
<li><strong>include_filename</strong>: We can identify the original
source file for each row:</li>
</ul>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">include_filename =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##    carat     cut  color clarity depth table price     x     y     z
##    &lt;num&gt;  &lt;char&gt; &lt;char&gt;  &lt;char&gt; &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
## 1:  0.23   Ideal      E     SI2  61.5    55   326  3.95  3.98  2.43
## 2:  0.21 Premium      E     SI1  59.8    61   326  3.89  3.84  2.31
## 3:  0.23    Good      E     VS1  56.9    65   327  4.05  4.07  2.31
## 4:  0.29 Premium      I     VS2  62.4    58   334  4.20  4.23  2.63
## 5:  0.31    Good      J     SI2  63.3    58   335  4.34  4.35  2.75
##                                                file
##                                              &lt;char&gt;
## 1: /tmp/RtmpBDbY6w/grepreaper_vignette/diamonds.csv
## 2: /tmp/RtmpBDbY6w/grepreaper_vignette/diamonds.csv
## 3: /tmp/RtmpBDbY6w/grepreaper_vignette/diamonds.csv
## 4: /tmp/RtmpBDbY6w/grepreaper_vignette/diamonds.csv
## 5: /tmp/RtmpBDbY6w/grepreaper_vignette/diamonds.csv</code></pre>
<p>This is especially helpful when reading through multiple files, which
will be discussed in more detail later in this document.</p>
<p>This adds -H to the grep command:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">include_filename =</span> <span class="cn">TRUE</span>, <span class="at">show_cmd =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;&#39;/usr/bin/grep&#39; -H &#39;&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/diamonds.csv&#39;&quot;</code></pre>
<ul>
<li><strong>show_line_numbers</strong>: This provides the rows indices
of the original files:</li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;Ideal&quot;</span>, <span class="at">show_line_numbers =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##    carat    cut  color clarity depth table price     x     y     z line_number
##    &lt;num&gt; &lt;char&gt; &lt;char&gt;  &lt;char&gt; &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;       &lt;num&gt;
## 1:    NA  Ideal      E     SI2  61.5    55   326  3.95  3.98  2.43          NA
## 2:    NA  Ideal      J     VS1  62.8    56   340  3.93  3.90  2.46          NA
## 3:    NA  Ideal      J     SI2  62.2    54   344  4.35  4.37  2.71          NA
## 4:    NA  Ideal      I     SI2  62.0    54   348  4.31  4.34  2.68          NA
## 5:    NA  Ideal      I     SI2  61.8    55   403  4.49  4.51  2.78          NA</code></pre>
<p>Note that the displayed indices have an assumption that headers are
not part of the count. This is an adjustment from the outputs of grep,
which would ordinarily include the headers. (This effectively removes 1
from grep’s counts.)</p>
<p>Showing the line number adds -n to the grep command:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;Ideal&quot;</span>, <span class="at">show_line_numbers =</span> <span class="cn">TRUE</span>, <span class="at">show_cmd =</span> T)</span></code></pre></div>
<pre><code>## [1] &quot;&#39;/usr/bin/grep&#39; -n -H &#39;Ideal&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/diamonds.csv&#39;&quot;</code></pre>
<p>For processing purposes behind the scenes, we maintain the -H for
filenames when extracting the line numbers. These filenames are removed
if not specifically requested.</p>
</div>
<div id="aggregating-data-from-multiple-files" class="section level2">
<h2>Aggregating Data from Multiple Files</h2>
<p>Some data systems include records that are spread out over many
similar files. For our purposes, we will assume that all of the relevant
files have the same structure (number of columns, column names, and
order of columns).</p>
<p>As an example data set, we have provided 1000 files of simulated
ratings. Each row shows how a <strong>user</strong>,
<strong>item</strong> and a <strong>rating</strong> on a 1-5 Likert
scale. The files are organized so that each user’s ratings are contained
in a unique file.</p>
<p>Most file reading programs in R only read a single file at a time. As
a result, we would have to iterate through the reading process. Then all
of the data would require aggregation, using functions like rbind() to
create a single object.</p>
<p>We can improve upon this process with another application of grep at
the command line. This is set up to read and aggregate data from many
files, all in a single line of code. The <strong>grep_read()</strong>
function implements this with a simple call:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a>two_files <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ratings_data/file_1.csv&quot;</span>, <span class="st">&quot;ratings_data/file_2.csv&quot;</span>)</span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> two_files)</span></code></pre></div>
<pre><code>##          user             item rating
##        &lt;char&gt;           &lt;char&gt;  &lt;int&gt;
##   1: a7gzXxfI 0JFCjVx2P1RMzy3h      4
##   2: a7gzXxfI 0kG80toKp2msfAut      5
##   3: a7gzXxfI 1Bji5PQIOKXaMGZq      3
##   4: a7gzXxfI 1fg4sLgEFzAtOqCa      5
##   5: a7gzXxfI 3k7Wf4yv0RV6vi4K      5
##  ---                                 
## 211: MAYVCdgd whllyERYJir9lTi6      2
## 212: MAYVCdgd ykBGM3UcRgF8whc5      5
## 213: MAYVCdgd ypJCM39tzfpxsVgB      3
## 214: MAYVCdgd yrltwtIEX93JzLYx      2
## 215: MAYVCdgd zQBDgVrQmSYGpYrn      4</code></pre>
<p>We can also show the underlying grep command:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> two_files, <span class="at">show_cmd =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;&#39;/usr/bin/grep&#39; -H &#39;&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_1.csv&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_2.csv&#39;&quot;</code></pre>
<p>We could likewise read in the data for 10 files:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a>ten_files <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;ratings_data/file_%d.csv&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> ten_files)</span></code></pre></div>
<pre><code>##           user             item rating
##         &lt;char&gt;           &lt;char&gt;  &lt;int&gt;
##    1: a7gzXxfI 0JFCjVx2P1RMzy3h      4
##    2: a7gzXxfI 0kG80toKp2msfAut      5
##    3: a7gzXxfI 1Bji5PQIOKXaMGZq      3
##    4: a7gzXxfI 1fg4sLgEFzAtOqCa      5
##    5: a7gzXxfI 3k7Wf4yv0RV6vi4K      5
##   ---                                 
## 1016: QPW5X7ci uNp5n9ziPoSjwab6      1
## 1017: QPW5X7ci uPU8XKJD4wo3Twss      1
## 1018: QPW5X7ci uXjCOKMvr1gPaxTg      4
## 1019: QPW5X7ci vPI43TEe3CMQUM5U      3
## 1020: QPW5X7ci wN8YPrJls7N3vGjC      1</code></pre>
<p>Because each filename is appended, the grep command becomes quite
lengthy:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> ten_files, <span class="at">show_cmd =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;&#39;/usr/bin/grep&#39; -H &#39;&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_1.csv&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_2.csv&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_3.csv&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_4.csv&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_5.csv&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_6.csv&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_7.csv&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_8.csv&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_9.csv&#39; &#39;/tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_10.csv&#39;&quot;</code></pre>
<p>Now we can scale up to reading data from all 1000 files. First, we
can use the list.files() function from base R to obtain all of the file
names:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a>all_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">&quot;ratings_data&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;.csv&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a><span class="fu">length</span>(all_files)</span></code></pre></div>
<pre><code>## [1] 1000</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a>all_files[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##  [1] &quot;ratings_data/file_1.csv&quot;    &quot;ratings_data/file_10.csv&quot;  
##  [3] &quot;ratings_data/file_100.csv&quot;  &quot;ratings_data/file_1000.csv&quot;
##  [5] &quot;ratings_data/file_101.csv&quot;  &quot;ratings_data/file_102.csv&quot; 
##  [7] &quot;ratings_data/file_103.csv&quot;  &quot;ratings_data/file_104.csv&quot; 
##  [9] &quot;ratings_data/file_105.csv&quot;  &quot;ratings_data/file_106.csv&quot;</code></pre>
<p>Then we can proceed with reading and aggregating all of the ratings
data:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a>ratings <span class="ot">&lt;-</span> <span class="fu">grep_read</span>(<span class="at">files =</span> all_files)</span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a>ratings</span></code></pre></div>
<pre><code>##             user             item rating
##           &lt;char&gt;           &lt;char&gt;  &lt;int&gt;
##      1: a7gzXxfI 0JFCjVx2P1RMzy3h      4
##      2: a7gzXxfI 0kG80toKp2msfAut      5
##      3: a7gzXxfI 1Bji5PQIOKXaMGZq      3
##      4: a7gzXxfI 1fg4sLgEFzAtOqCa      5
##      5: a7gzXxfI 3k7Wf4yv0RV6vi4K      5
##     ---                                 
##  99996: mbPQOZV1 yO8XGg7a9UHbqatL      3
##  99997: mbPQOZV1 ySHGYLNC7XtywfIZ      2
##  99998: mbPQOZV1 yeZcUlaFqrZmEB9a      3
##  99999: mbPQOZV1 yrltwtIEX93JzLYx      5
## 100000: mbPQOZV1 zfL4EAaUxSMqxtX1      4</code></pre>
<p>From there, we can utilize pattern matching to extract only the
relevant records. For instance, this data system stores ratings by
users. What if we wanted to pull only the ratings for a specific
item?</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a>ratings_0kG80toKp2msfAut <span class="ot">&lt;-</span> <span class="fu">grep_read</span>(<span class="at">files =</span> all_files, <span class="at">pattern =</span> <span class="st">&quot;0kG80toKp2msfAut&quot;</span>)</span>
<span id="cb63-2"><a href="#cb63-2" tabindex="-1"></a>ratings_0kG80toKp2msfAut</span></code></pre></div>
<pre><code>##         user             item rating
##       &lt;char&gt;           &lt;char&gt;  &lt;int&gt;
##  1: a7gzXxfI 0kG80toKp2msfAut      5
##  2: ubDjTvkL 0kG80toKp2msfAut      4
##  3: f6jyi1qQ 0kG80toKp2msfAut      3
##  4: 1bfhCeqd 0kG80toKp2msfAut      5
##  5: lWRx7GS2 0kG80toKp2msfAut      3
##  6: DacQCxYF 0kG80toKp2msfAut      3
##  7: q0BbKPHJ 0kG80toKp2msfAut      3
##  8: mtUWll4C 0kG80toKp2msfAut      5
##  9: H6hvxoOW 0kG80toKp2msfAut      3
## 10: 46QYwhP8 0kG80toKp2msfAut      2
## 11: h24ByYiR 0kG80toKp2msfAut      3
## 12: pFhDzh0S 0kG80toKp2msfAut      2
## 13: r3YTt57i 0kG80toKp2msfAut      5
## 14: pjzqBFA5 0kG80toKp2msfAut      2
## 15: SwSOmItk 0kG80toKp2msfAut      5
## 16: 6GTMPHOM 0kG80toKp2msfAut      5
## 17: ibeTAm2i 0kG80toKp2msfAut      1
## 18: XV43a0gJ 0kG80toKp2msfAut      5
## 19: 2PI4m8Ph 0kG80toKp2msfAut      2
## 20: INFoOzcl 0kG80toKp2msfAut      2
## 21: WsJ3NTIz 0kG80toKp2msfAut      2
## 22: UxZFRUDw 0kG80toKp2msfAut      3
## 23: d0UWBOdu 0kG80toKp2msfAut      4
## 24: WuwhZcby 0kG80toKp2msfAut      4
## 25: wnqaJvdi 0kG80toKp2msfAut      5
## 26: tlDiX2S0 0kG80toKp2msfAut      1
## 27: 5aq67PrC 0kG80toKp2msfAut      3
## 28: jM1eZyHf 0kG80toKp2msfAut      5
## 29: w876zsaH 0kG80toKp2msfAut      1
## 30: YiauYpGv 0kG80toKp2msfAut      4
## 31: VSebteAH 0kG80toKp2msfAut      3
## 32: 88bH2EuY 0kG80toKp2msfAut      2
## 33: OiiM2Wwy 0kG80toKp2msfAut      5
## 34: CbLu7ceh 0kG80toKp2msfAut      2
## 35: 4aeOMRMe 0kG80toKp2msfAut      3
## 36: ETQknw07 0kG80toKp2msfAut      2
## 37: DTnw1mvw 0kG80toKp2msfAut      5
## 38: zCAYYlUO 0kG80toKp2msfAut      5
## 39: cUYDrWPG 0kG80toKp2msfAut      4
## 40: GyEodv7B 0kG80toKp2msfAut      2
## 41: UXsqMeDv 0kG80toKp2msfAut      5
## 42: a6hokyIq 0kG80toKp2msfAut      4
## 43: vVRaiAQI 0kG80toKp2msfAut      2
## 44: q4QrA1OX 0kG80toKp2msfAut      1
## 45: yLQAEkVp 0kG80toKp2msfAut      1
## 46: qzWbvxr4 0kG80toKp2msfAut      5
## 47: AaQSukjk 0kG80toKp2msfAut      4
## 48: tkqYuTMN 0kG80toKp2msfAut      4
## 49: Ijdhor1J 0kG80toKp2msfAut      3
## 50: Z4uia0d3 0kG80toKp2msfAut      1
## 51: 7GMh2jz7 0kG80toKp2msfAut      4
## 52: 3C0GcKkV 0kG80toKp2msfAut      4
## 53: BHxRtzfl 0kG80toKp2msfAut      4
## 54: LzOjUaPM 0kG80toKp2msfAut      1
## 55: fqyjp1t8 0kG80toKp2msfAut      4
## 56: mDadxdJw 0kG80toKp2msfAut      2
## 57: RDtsFLfr 0kG80toKp2msfAut      2
## 58: GjEnU7LM 0kG80toKp2msfAut      3
## 59: Hw034ISx 0kG80toKp2msfAut      5
## 60: ZKKc1f4K 0kG80toKp2msfAut      1
## 61: cBOeESyA 0kG80toKp2msfAut      4
## 62: mbPQOZV1 0kG80toKp2msfAut      1
##         user             item rating</code></pre>
<p>File reading can also be performed recursively. This means we would
not have to specify all of the filenames in a long list Instead, we can
specify a file path, a file pattern (such as searching all .csv files),
and recursive search:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a>ratings_1fg4sLgEFzAtOqCa <span class="ot">&lt;-</span> <span class="fu">grep_read</span>(<span class="at">path =</span> <span class="st">&quot;ratings_data&quot;</span>, <span class="at">file_pattern =</span> <span class="st">&quot;.csv&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;1fg4sLgEFzAtOqCa&quot;</span>)</span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>ratings_1fg4sLgEFzAtOqCa</span></code></pre></div>
<pre><code>##         user             item rating
##       &lt;char&gt;           &lt;char&gt;  &lt;int&gt;
##  1: a7gzXxfI 1fg4sLgEFzAtOqCa      5
##  2: 5p5qBUBD 1fg4sLgEFzAtOqCa      3
##  3: pBaqmBhe 1fg4sLgEFzAtOqCa      4
##  4: HLIFNhw6 1fg4sLgEFzAtOqCa      5
##  5: TkRp2BwJ 1fg4sLgEFzAtOqCa      3
##  6: hxNdw0dh 1fg4sLgEFzAtOqCa      1
##  7: K3JNdGqE 1fg4sLgEFzAtOqCa      5
##  8: FnLcjBUD 1fg4sLgEFzAtOqCa      3
##  9: VQM97tZ0 1fg4sLgEFzAtOqCa      1
## 10: FKdHK4VB 1fg4sLgEFzAtOqCa      4
## 11: R4zQUkJR 1fg4sLgEFzAtOqCa      3
## 12: ePqBULvn 1fg4sLgEFzAtOqCa      2
## 13: N4GTRrFb 1fg4sLgEFzAtOqCa      1
## 14: CvTH7xOa 1fg4sLgEFzAtOqCa      1
## 15: e4qeBnXL 1fg4sLgEFzAtOqCa      1
## 16: BErL8Hxu 1fg4sLgEFzAtOqCa      4
## 17: Yg2ewVFg 1fg4sLgEFzAtOqCa      5
## 18: Aam6a118 1fg4sLgEFzAtOqCa      2
## 19: KGX1xysf 1fg4sLgEFzAtOqCa      5
## 20: d1YJSjy7 1fg4sLgEFzAtOqCa      5
## 21: MODzBk9T 1fg4sLgEFzAtOqCa      1
## 22: LX2Rgpby 1fg4sLgEFzAtOqCa      1
## 23: t1SQzASt 1fg4sLgEFzAtOqCa      2
## 24: jatOWMoP 1fg4sLgEFzAtOqCa      1
## 25: RTOWbarb 1fg4sLgEFzAtOqCa      2
## 26: GPwP2qHH 1fg4sLgEFzAtOqCa      2
## 27: OBBWuWnn 1fg4sLgEFzAtOqCa      5
## 28: DbME6W4i 1fg4sLgEFzAtOqCa      5
## 29: GOVaxEcq 1fg4sLgEFzAtOqCa      4
## 30: fr5X4VqD 1fg4sLgEFzAtOqCa      3
## 31: nCzPuNKO 1fg4sLgEFzAtOqCa      2
## 32: 5BxWelBT 1fg4sLgEFzAtOqCa      1
## 33: qBOKWWJK 1fg4sLgEFzAtOqCa      1
## 34: i13bMyA2 1fg4sLgEFzAtOqCa      2
## 35: YTM0LcoU 1fg4sLgEFzAtOqCa      5
## 36: MfpvuE1E 1fg4sLgEFzAtOqCa      1
## 37: zA8kUWEL 1fg4sLgEFzAtOqCa      3
## 38: pRfZVAly 1fg4sLgEFzAtOqCa      5
## 39: KOgveFtc 1fg4sLgEFzAtOqCa      4
## 40: 37i68wEl 1fg4sLgEFzAtOqCa      4
## 41: YHLa8K3d 1fg4sLgEFzAtOqCa      4
## 42: Ow8P0Khj 1fg4sLgEFzAtOqCa      5
## 43: NzewKI5D 1fg4sLgEFzAtOqCa      2
## 44: S4sEPme8 1fg4sLgEFzAtOqCa      4
## 45: pT8GySsT 1fg4sLgEFzAtOqCa      2
## 46: NJzkLGMB 1fg4sLgEFzAtOqCa      3
## 47: 20eWOyCk 1fg4sLgEFzAtOqCa      3
## 48: CLMckhJh 1fg4sLgEFzAtOqCa      1
## 49: p3FtvitJ 1fg4sLgEFzAtOqCa      2
## 50: pYi4Ntgz 1fg4sLgEFzAtOqCa      4
## 51: RSd5Y36Q 1fg4sLgEFzAtOqCa      3
## 52: P2ytjcZm 1fg4sLgEFzAtOqCa      4
##         user             item rating</code></pre>
<p>With these tools, we now have a simple method that can read,
pre-filter, and aggregate data from multiple files.</p>
</div>
<div id="counting-records" class="section level2">
<h2>Counting Records</h2>
<p>File reading begins with an uncertainty about the overall dimensions
of the data to be read. We can read a few sample rows to understand the
column structure, specifying the nrows parameter:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a><span class="fu">grep_read</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">nrows =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##    carat     cut  color clarity depth table price     x     y     z
##    &lt;num&gt;  &lt;char&gt; &lt;char&gt;  &lt;char&gt; &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
## 1:  0.23   Ideal      E     SI2  61.5    55   326  3.95  3.98  2.43
## 2:  0.21 Premium      E     SI1  59.8    61   326  3.89  3.84  2.31
## 3:  0.23    Good      E     VS1  56.9    65   327  4.05  4.07  2.31</code></pre>
<p>However, we do not necessarily know the overall number of rows in
advance. This is another place in which utilizing grep at the command
line can be of benefit. It can count the rows in a file without reading
the full data. The grepreaper package utilizes a grep_count() function
to perform this task:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a><span class="fu">grep_count</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>)</span></code></pre></div>
<pre><code>##    count
##    &lt;num&gt;
## 1: 53940</code></pre>
<p>Counting can be performed with multiple files from the ratings
data:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a><span class="fu">grep_count</span>(<span class="at">files =</span> ten_files)</span></code></pre></div>
<pre><code>##     count
##     &lt;num&gt;
##  1:   110
##  2:   105
##  3:   117
##  4:    94
##  5:   102
##  6:   102
##  7:   109
##  8:    82
##  9:   109
## 10:    90</code></pre>
<p>We can also choose to include the filenames:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a><span class="fu">grep_count</span>(<span class="at">files =</span> ten_files, <span class="at">include_filename =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##                                                             file count
##                                                           &lt;char&gt; &lt;num&gt;
##  1:  /tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_1.csv   110
##  2:  /tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_2.csv   105
##  3:  /tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_3.csv   117
##  4:  /tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_4.csv    94
##  5:  /tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_5.csv   102
##  6:  /tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_6.csv   102
##  7:  /tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_7.csv   109
##  8:  /tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_8.csv    82
##  9:  /tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_9.csv   109
## 10: /tmp/RtmpBDbY6w/grepreaper_vignette/ratings_data/file_10.csv    90</code></pre>
<p>Pattern matching can also be applied:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a><span class="fu">grep_count</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;VVS1&quot;</span>)</span></code></pre></div>
<pre><code>##    count
##    &lt;num&gt;
## 1:  3654</code></pre>
<p>Likewise, the full range of options for the pattern-matching can also
be applied, such as an inverted search:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a><span class="fu">grep_count</span>(<span class="at">files =</span> <span class="st">&quot;diamonds.csv&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;VVS1&quot;</span>, <span class="at">invert =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##    count
##    &lt;num&gt;
## 1: 50285</code></pre>
<p>Word matching can be useful to find all cases of a 5-star rating:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a><span class="fu">grep_count</span>(<span class="at">files =</span> all_files, <span class="at">pattern =</span> <span class="st">&quot;5&quot;</span>, <span class="at">word_match =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##       count
##       &lt;num&gt;
##    1:    17
##    2:    15
##    3:    19
##    4:    15
##    5:    21
##   ---      
##  996:    18
##  997:    16
##  998:    18
##  999:    23
## 1000:    20</code></pre>
<p>With word matching, we will avoid extracting rows that include the
pattern “5” as part of the identifier for an item or user but do not
include a 5-star rating.</p>
</div>
<div id="discussion" class="section level2">
<h2>Discussion</h2>
<p>The grepreaper package introduces a number of tools that greatly
simplify the process of reading data. Some of its benefits include:</p>
<ul>
<li><p><strong>Simple Programming</strong>: A single function can
replace iterated calls to file reading tools. No knowledge of the syntax
of grep at the command line is required.</p></li>
<li><p><strong>Pre-Counting</strong>: The grep_count() function allows
us to understand the size of the data prior to reading it in.</p></li>
<li><p><strong>Aggregation</strong>: The grep_read() function
automatically binds the data from all sources without additional
programming.</p></li>
<li><p><strong>Pre-Filtering</strong>: With pattern matching in
grep_read(), users can read in only the relevant records of data. This
is more efficient than filtering after reading all of the data. In fact,
we can use pre-filtering to search and aggregate data from vast file
systems.</p></li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
